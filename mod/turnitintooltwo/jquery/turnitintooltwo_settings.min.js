jQuery(document).ready(function($){if($(".settingsform fieldset div.formsettingheading").length>0){var tabmenu=$(".settingsform fieldset div.formsettingheading:first").html();tabmenu.indexOf("tabtree")>=0&&($(".settingsform fieldset div.formsettingheading:first").remove(),$(".settingsform h2:first").after(tabmenu))}$('input[name="selectallcb"]').click(function(){$(this).prop("checked")?($(".browser_checkbox").prop("checked",!0),$(".browser_checkbox:checked").length>0?$(".create_checkboxes").slideDown():$(".create_checkboxes").slideUp()):($(".browser_checkbox").prop("checked",!1),$(".create_checkboxes").slideUp())}),$(".tii_upgrade_check").click(function(t){t.preventDefault();var e="ajax.php";$(".settingsform fieldset div.formsettingheading").length>0&&(e="../mod/turnitintooltwo/ajax.php"),$(".tii_upgrade_check").hide(),$(".tii_upgrading_check").css("display","inline-block");var i=$(this).attr("id").split("_")[1];$.ajax({type:"POST",url:e,dataType:"html",data:{action:"check_upgrade",current_version:i,sesskey:M.cfg.sesskey},success:function(t){var t=$.parseJSON(t);1===t.update?($(".tii_upgrade_check").hide(),$(".tii_upgrading_check").hide(),$(".tii_no_upgrade").html('<a href="'+t.file[0]+'">'+M.str.turnitintooltwo.upgradeavailable+"</a>")):($(".tii_upgrading_check").hide(),$(".tii_upgrade_check").show())}})}),$(".test_connection").length>0&&((""!=$("#id_s_turnitintooltwo_accountid").val()||""!=$("#id_s_turnitintooltwo_secretkey").val())&&($(".test_connection").show(),$("#test_link").show()),$("#id_s_turnitintooltwo_accountid, #id_s_turnitintooltwo_secretkey, #id_s_turnitintooltwo_apiurl").keyup(function(){$("#testing_container").hide();var t=$("#id_s_turnitintooltwo_accountid").val(),e=$("#id_s_turnitintooltwo_secretkey").val();""!=t&&""!=e&&/\S/.test(t)&&/\S/.test(e)?($(".test_connection").show(),$("#test_link").show()):($("#test_result").hide(),$(".test_connection").hide())}),$("#test_link").click(function(){$("#test_result").hide(),$("input, #id_s_turnitintooltwo_apiurl").prop("disabled",!0),$("#test_link").hide(),$("#test_result").css("opacity",""),$("#test_result").removeClass("test_link_success test_link_fail"),$("#testing_container").show();var url="ajax.php";$(".settingsform fieldset div.formsettingheading").length>0&&(url="../mod/turnitintooltwo/ajax.php");var accountid=$("#id_s_turnitintooltwo_accountid").val(),accountshared=$("#id_s_turnitintooltwo_secretkey").val(),accounturl=$("#id_s_turnitintooltwo_apiurl").val();$.ajax({type:"POST",url:url,dataType:"json",data:{action:"test_connection",sesskey:M.cfg.sesskey,account_id:accountid,account_shared:accountshared,url:accounturl},success:function(data){eval(data),$("#testing_container").hide(),"success"==data.connection_status?$("#test_result").addClass("test_link_success"):$("#test_result").addClass("test_link_fail"),$("#test_result").html(data.msg),$("#test_result").show(),$("#test_link").show(),$("input, #id_s_turnitintooltwo_apiurl").prop("disabled",!1)}})}))});